# 计算引擎 / Calculation Engine

## 概述 / Overview

计算引擎是控制塔后端的核心组件，负责对集成的数据进行处理和分析，生成KPI指标和业务洞察，为控制塔前端提供数据支持。

The calculation engine is a core component of the control tower backend, responsible for processing and analyzing integrated data, generating KPI metrics and business insights, and providing data support for the control tower frontend.

## 计算引擎定位 / Calculation Engine Positioning

在整体架构中，计算引擎位于数据集成层和API服务层之间，承担以下角色：

In the overall architecture, the calculation engine is positioned between the data integration layer and the API service layer, taking on the following roles:

- **数据处理中枢 / Data Processing Hub**: 对集成的原始数据进行加工和转换
  
  Process and transform integrated raw data

- **指标计算器 / Metric Calculator**: 根据定义的KPI计算公式生成各类指标
  
  Generate various metrics according to defined KPI calculation formulas

- **分析决策支持 / Analysis Decision Support**: 提供数据分析和决策支持能力
  
  Provide data analysis and decision support capabilities

## 计算能力 / Calculation Capabilities

计算引擎提供以下核心计算能力：

The calculation engine provides the following core calculation capabilities:

### 实时计算 / Real-time Calculation

- **事件驱动计算 / Event-driven Calculation**: 基于业务事件触发的实时指标计算
  
  Real-time metric calculation triggered by business events

- **流式数据处理 / Stream Data Processing**: 处理连续产生的设备状态和位置数据
  
  Process continuously generated equipment status and location data

- **实时告警生成 / Real-time Alert Generation**: 基于规则引擎生成异常和告警信息
  
  Generate exception and alert information based on rule engines

### 批量计算 / Batch Calculation

- **历史数据分析 / Historical Data Analysis**: 对历史数据进行统计和趋势分析
  
  Perform statistical and trend analysis on historical data

- **周期性报表生成 / Periodic Report Generation**: 生成日报、周报、月报等统计报表
  
  Generate daily, weekly, monthly, and other statistical reports

- **复杂指标计算 / Complex Metric Calculation**: 计算需要大量数据支持的复杂指标
  
  Calculate complex metrics that require large amounts of data support


## 计算调度 / Calculation Scheduling

计算引擎采用多种调度机制，确保各类KPI的及时更新：

The calculation engine uses multiple scheduling mechanisms to ensure timely updates of various KPIs:

### 调度类型 / Scheduling Types

- **实时触发 / Real-time Triggering**: 由业务事件直接触发的计算任务
  
  Calculation tasks directly triggered by business events

- **定时调度 / Scheduled Timing**: 按预定时间间隔执行的计算任务
  
  Calculation tasks executed at predetermined time intervals

- **手动触发 / Manual Triggering**: 由用户操作触发的按需计算
  
  On-demand calculations triggered by user operations

### 调度频率 / Scheduling Frequency

不同类型的KPI根据其特性和业务需求采用不同的计算频率：

Different types of KPIs use different calculation frequencies based on their characteristics and business requirements:

- **高频指标 / High-frequency Metrics**: 实时或准实时更新（秒/分钟级）
  
  Real-time or near real-time updates (seconds/minutes level)
  
  示例：设备位置、运行状态、告警信息
  
  Examples: Equipment location, operational status, alert information

- **中频指标 / Medium-frequency Metrics**: 定期更新（小时级）
  
  Regular updates (hourly level)
  
  示例：生产效率、装载率、运输量
  
  Examples: Production efficiency, loading rate, transportation volume

- **低频指标 / Low-frequency Metrics**: 日常或更长周期更新（天/周/月级）
  
  Daily or longer cycle updates (day/week/month level)
  
  示例：设备利用率、燃料效率、维护指标
  
  Examples: Equipment utilization, fuel efficiency, maintenance metrics

## 与KPI的关系 / Relationship with KPIs

计算引擎是KPI实现的技术支撑，与KPI体系的关系如下：

The calculation engine is the technical support for KPI implementation, with the following relationship to the KPI system:

### KPI实现支持 / KPI Implementation Support

- **数据准备 / Data Preparation**: 为KPI计算准备必要的数据元素
  
  Prepare necessary data elements for KPI calculation

- **计算执行 / Calculation Execution**: 执行KPI定义中的计算公式
  
  Execute calculation formulas defined in KPIs

- **结果存储 / Result Storage**: 存储KPI计算结果，支持历史追踪和趋势分析
  
  Store KPI calculation results to support historical tracking and trend analysis

### KPI分类处理 / KPI Classification Processing

计算引擎针对不同类别的KPI采用不同的处理策略：

The calculation engine adopts different processing strategies for different categories of KPIs:

- **流程KPI / Process KPIs**: 关注业务流程各环节的效率和质量指标
  
  Focus on efficiency and quality metrics for various links in business processes
  
  处理方式：结合事件数据和状态数据，计算流程效率和质量指标
  
  Processing method: Combine event data and status data to calculate process efficiency and quality metrics

- **资源KPI / Resource KPIs**: 关注资源状态、利用率和健康度指标
  
  Focus on resource status, utilization, and health metrics
  
  处理方式：基于设备实时状态和历史数据，计算资源相关指标
  
  Processing method: Calculate resource-related metrics based on real-time equipment status and historical data

## 技术实现考量 / Technical Implementation Considerations

计算引擎的技术实现需考虑以下因素：

The technical implementation of the calculation engine needs to consider the following factors:

- **可扩展性 / Scalability**: 支持新增KPI和计算逻辑的灵活扩展
  
  Support flexible expansion of new KPIs and calculation logic

- **性能优化 / Performance Optimization**: 确保高频计算和大数据量处理的性能
  
  Ensure performance for high-frequency calculations and large data volume processing

- **容错机制 / Fault Tolerance**: 具备数据异常和计算失败的处理机制
  
  Have mechanisms for handling data anomalies and calculation failures
